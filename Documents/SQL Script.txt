-- =================================================================
--  This script creates tables for an inventory or asset management
--  system. The tables are created first, and then foreign key
--  constraints are added to prevent ordering issues.
-- =================================================================

-- -----------------------------------------------------------------
--  TABLE CREATION
-- -----------------------------------------------------------------

-- Users Table (Inferred from 'Uses')
-- Stores user information. This table is created first as many other
-- tables have foreign key references to it.
CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    user_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(50),
    password_hash VARCHAR(255) NOT NULL, -- Storing hashed passwords is a security best practice
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INT, -- Can be self-referencing or null for the first user
    is_updated BOOLEAN DEFAULT FALSE,
    is_deleted BOOLEAN DEFAULT FALSE
);

-- Category Table
-- Stores product categories.
CREATE TABLE categories (
    category_id INT PRIMARY KEY AUTO_INCREMENT,
    category_name VARCHAR(255) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INT,
    is_updated BOOLEAN DEFAULT FALSE,
    is_deleted BOOLEAN DEFAULT FALSE
);

-- Brand Table
-- Stores product brands, linked to a category.
CREATE TABLE brands (
    brand_id INT PRIMARY KEY AUTO_INCREMENT,
    category_id INT NOT NULL,
    brand_name VARCHAR(255) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INT,
    is_updated BOOLEAN DEFAULT FALSE,
    is_deleted BOOLEAN DEFAULT FALSE
);

-- Model Table
-- Stores product models, linked to a brand and category.
CREATE TABLE models (
    model_id INT PRIMARY KEY AUTO_INCREMENT,
    category_id INT NOT NULL,
    brand_id INT NOT NULL,
    model_name VARCHAR(255) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INT,
    is_updated BOOLEAN DEFAULT FALSE,
    is_deleted BOOLEAN DEFAULT FALSE
);

-- Vendor Table
-- Stores information about suppliers or vendors.
CREATE TABLE vendors (
    vendor_id INT PRIMARY KEY AUTO_INCREMENT,
    vendor_name VARCHAR(255) NOT NULL,
    contact_person VARCHAR(255),
    address TEXT,
    phone VARCHAR(50),
    email VARCHAR(255),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INT,
    is_updated BOOLEAN DEFAULT FALSE,
    is_deleted BOOLEAN DEFAULT FALSE
);

-- Purchased Products Table (Corrected from 'Purchased_Prtoduct')
-- A log of all products that have been purchased.
CREATE TABLE purchased_products (
    purchase_id INT PRIMARY KEY AUTO_INCREMENT,
    vendor_id INT NOT NULL,
    purchase_date DATE,
    invoice_number VARCHAR(255),
    category_id INT NOT NULL,
    brand_id INT NOT NULL,
    model_id INT NOT NULL,
    quantity INT NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    warranty_period VARCHAR(100),
    serial_number VARCHAR(255) UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INT
);


-- Purchase Temp Table (From 'Temp_Table')
-- A temporary table for staging purchase data before finalizing.
CREATE TABLE purchase_temp (
    temp_purchase_id INT PRIMARY KEY AUTO_INCREMENT,
    vendor_id INT NOT NULL,
    purchase_date DATE,
    invoice_number VARCHAR(255),
    category_id INT NOT NULL,
    brand_id INT NOT NULL,
    model_id INT NOT NULL,
    quantity INT NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    warranty_period VARCHAR(100),
    serial_number VARCHAR(255),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INT
);


-- -----------------------------------------------------------------
--  FOREIGN KEY CONSTRAINTS
-- -----------------------------------------------------------------
-- Constraints are added after all tables are created.

-- Constraints for 'categories' table
ALTER TABLE categories ADD CONSTRAINT fk_categories_created_by FOREIGN KEY (created_by) REFERENCES users(user_id);

-- Constraints for 'brands' table
ALTER TABLE brands ADD CONSTRAINT fk_brands_category FOREIGN KEY (category_id) REFERENCES categories(category_id);
ALTER TABLE brands ADD CONSTRAINT fk_brands_created_by FOREIGN KEY (created_by) REFERENCES users(user_id);

-- Constraints for 'models' table
ALTER TABLE models ADD CONSTRAINT fk_models_category FOREIGN KEY (category_id) REFERENCES categories(category_id);
ALTER TABLE models ADD CONSTRAINT fk_models_brand FOREIGN KEY (brand_id) REFERENCES brands(brand_id);
ALTER TABLE models ADD CONSTRAINT fk_models_created_by FOREIGN KEY (created_by) REFERENCES users(user_id);

-- Constraints for 'vendors' table
ALTER TABLE vendors ADD CONSTRAINT fk_vendors_created_by FOREIGN KEY (created_by) REFERENCES users(user_id);

-- Constraints for 'purchased_products' table
ALTER TABLE purchased_products ADD CONSTRAINT fk_purchased_vendor FOREIGN KEY (vendor_id) REFERENCES vendors(vendor_id);
ALTER TABLE purchased_products ADD CONSTRAINT fk_purchased_category FOREIGN KEY (category_id) REFERENCES categories(category_id);
ALTER TABLE purchased_products ADD CONSTRAINT fk_purchased_brand FOREIGN KEY (brand_id) REFERENCES brands(brand_id);
ALTER TABLE purchased_products ADD CONSTRAINT fk_purchased_model FOREIGN KEY (model_id) REFERENCES models(model_id);
ALTER TABLE purchased_products ADD CONSTRAINT fk_purchased_created_by FOREIGN KEY (created_by) REFERENCES users(user_id);

-- Constraints for 'purchase_temp' table
ALTER TABLE purchase_temp ADD CONSTRAINT fk_temp_vendor FOREIGN KEY (vendor_id) REFERENCES vendors(vendor_id);
ALTER TABLE purchase_temp ADD CONSTRAINT fk_temp_category FOREIGN KEY (category_id) REFERENCES categories(category_id);
ALTER TABLE purchase_temp ADD CONSTRAINT fk_temp_brand FOREIGN KEY (brand_id) REFERENCES brands(brand_id);
ALTER TABLE purchase_temp ADD CONSTRAINT fk_temp_model FOREIGN KEY (model_id) REFERENCES models(model_id);
ALTER TABLE purchase_temp ADD CONSTRAINT fk_temp_created_by FOREIGN KEY (created_by) REFERENCES users(user_id);

-- =================================================================
--  End of Script
-- =================================================================
